{"ast":null,"code":"import { DEFAULT_TIMEOUT } from '../lib/constants';\nexport default class Push {\n  /**\r\n   * Initializes the Push\r\n   *\r\n   * @param channel The Channel\r\n   * @param event The event, for example `\"phx_join\"`\r\n   * @param payload The payload, for example `{user_id: 123}`\r\n   * @param timeout The push timeout in milliseconds\r\n   */\n  constructor(channel, event, payload = {}, timeout = DEFAULT_TIMEOUT) {\n    this.channel = channel;\n    this.event = event;\n    this.payload = payload;\n    this.timeout = timeout;\n    this.sent = false;\n    this.timeoutTimer = undefined;\n    this.ref = '';\n    this.receivedResp = null;\n    this.recHooks = [];\n    this.refEvent = null;\n  }\n  resend(timeout) {\n    this.timeout = timeout;\n    this._cancelRefEvent();\n    this.ref = '';\n    this.refEvent = null;\n    this.receivedResp = null;\n    this.sent = false;\n    this.send();\n  }\n  send() {\n    if (this._hasReceived('timeout')) {\n      return;\n    }\n    this.startTimeout();\n    this.sent = true;\n    this.channel.socket.push({\n      topic: this.channel.topic,\n      event: this.event,\n      payload: this.payload,\n      ref: this.ref,\n      join_ref: this.channel._joinRef()\n    });\n  }\n  updatePayload(payload) {\n    this.payload = Object.assign(Object.assign({}, this.payload), payload);\n  }\n  receive(status, callback) {\n    var _a;\n    if (this._hasReceived(status)) {\n      callback((_a = this.receivedResp) === null || _a === void 0 ? void 0 : _a.response);\n    }\n    this.recHooks.push({\n      status,\n      callback\n    });\n    return this;\n  }\n  startTimeout() {\n    if (this.timeoutTimer) {\n      return;\n    }\n    this.ref = this.channel.socket._makeRef();\n    this.refEvent = this.channel._replyEventName(this.ref);\n    const callback = payload => {\n      this._cancelRefEvent();\n      this._cancelTimeout();\n      this.receivedResp = payload;\n      this._matchReceive(payload);\n    };\n    this.channel._on(this.refEvent, {}, callback);\n    this.timeoutTimer = setTimeout(() => {\n      this.trigger('timeout', {});\n    }, this.timeout);\n  }\n  trigger(status, response) {\n    if (this.refEvent) this.channel._trigger(this.refEvent, {\n      status,\n      response\n    });\n  }\n  destroy() {\n    this._cancelRefEvent();\n    this._cancelTimeout();\n  }\n  _cancelRefEvent() {\n    if (!this.refEvent) {\n      return;\n    }\n    this.channel._off(this.refEvent, {});\n  }\n  _cancelTimeout() {\n    clearTimeout(this.timeoutTimer);\n    this.timeoutTimer = undefined;\n  }\n  _matchReceive({\n    status,\n    response\n  }) {\n    this.recHooks.filter(h => h.status === status).forEach(h => h.callback(response));\n  }\n  _hasReceived(status) {\n    return this.receivedResp && this.receivedResp.status === status;\n  }\n}","map":{"version":3,"mappings":"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","names":["DEFAULT_TIMEOUT","Push","constructor","channel","event","payload","timeout","undefined","resend","_cancelRefEvent","ref","refEvent","receivedResp","sent","send","_hasReceived","startTimeout","socket","push","topic","join_ref","_joinRef","updatePayload","receive","status","callback","response","recHooks","timeoutTimer","_makeRef","_replyEventName","_cancelTimeout","_matchReceive","_on","setTimeout","trigger","_trigger","destroy","_off","clearTimeout","filter","h","forEach"],"sources":["C:\\Users\\Ryan\\Documents\\COP4808\\hw7\\final-project-RyanEisele1012\\node_modules\\@supabase\\realtime-js\\src\\lib\\push.ts"],"sourcesContent":["import { DEFAULT_TIMEOUT } from '../lib/constants'\r\nimport type RealtimeChannel from '../RealtimeChannel'\r\n\r\nexport default class Push {\r\n  sent: boolean = false\r\n  timeoutTimer: number | undefined = undefined\r\n  ref: string = ''\r\n  receivedResp: {\r\n    status: string\r\n    response: { [key: string]: any }\r\n  } | null = null\r\n  recHooks: {\r\n    status: string\r\n    callback: Function\r\n  }[] = []\r\n  refEvent: string | null = null\r\n\r\n  /**\r\n   * Initializes the Push\r\n   *\r\n   * @param channel The Channel\r\n   * @param event The event, for example `\"phx_join\"`\r\n   * @param payload The payload, for example `{user_id: 123}`\r\n   * @param timeout The push timeout in milliseconds\r\n   */\r\n  constructor(\r\n    public channel: RealtimeChannel,\r\n    public event: string,\r\n    public payload: { [key: string]: any } = {},\r\n    public timeout: number = DEFAULT_TIMEOUT\r\n  ) {}\r\n\r\n  resend(timeout: number) {\r\n    this.timeout = timeout\r\n    this._cancelRefEvent()\r\n    this.ref = ''\r\n    this.refEvent = null\r\n    this.receivedResp = null\r\n    this.sent = false\r\n    this.send()\r\n  }\r\n\r\n  send() {\r\n    if (this._hasReceived('timeout')) {\r\n      return\r\n    }\r\n    this.startTimeout()\r\n    this.sent = true\r\n    this.channel.socket.push({\r\n      topic: this.channel.topic,\r\n      event: this.event,\r\n      payload: this.payload,\r\n      ref: this.ref,\r\n      join_ref: this.channel._joinRef(),\r\n    })\r\n  }\r\n\r\n  updatePayload(payload: { [key: string]: any }): void {\r\n    this.payload = { ...this.payload, ...payload }\r\n  }\r\n\r\n  receive(status: string, callback: Function) {\r\n    if (this._hasReceived(status)) {\r\n      callback(this.receivedResp?.response)\r\n    }\r\n\r\n    this.recHooks.push({ status, callback })\r\n    return this\r\n  }\r\n\r\n  startTimeout() {\r\n    if (this.timeoutTimer) {\r\n      return\r\n    }\r\n    this.ref = this.channel.socket._makeRef()\r\n    this.refEvent = this.channel._replyEventName(this.ref)\r\n\r\n    const callback = (payload: any) => {\r\n      this._cancelRefEvent()\r\n      this._cancelTimeout()\r\n      this.receivedResp = payload\r\n      this._matchReceive(payload)\r\n    }\r\n\r\n    this.channel._on(this.refEvent, {}, callback)\r\n\r\n    this.timeoutTimer = <any>setTimeout(() => {\r\n      this.trigger('timeout', {})\r\n    }, this.timeout)\r\n  }\r\n\r\n  trigger(status: string, response: any) {\r\n    if (this.refEvent)\r\n      this.channel._trigger(this.refEvent, { status, response })\r\n  }\r\n\r\n  destroy() {\r\n    this._cancelRefEvent()\r\n    this._cancelTimeout()\r\n  }\r\n\r\n  private _cancelRefEvent() {\r\n    if (!this.refEvent) {\r\n      return\r\n    }\r\n\r\n    this.channel._off(this.refEvent, {})\r\n  }\r\n\r\n  private _cancelTimeout() {\r\n    clearTimeout(this.timeoutTimer)\r\n    this.timeoutTimer = undefined\r\n  }\r\n\r\n  private _matchReceive({\r\n    status,\r\n    response,\r\n  }: {\r\n    status: string\r\n    response: Function\r\n  }) {\r\n    this.recHooks\r\n      .filter((h) => h.status === status)\r\n      .forEach((h) => h.callback(response))\r\n  }\r\n\r\n  private _hasReceived(status: string) {\r\n    return this.receivedResp && this.receivedResp.status === status\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}